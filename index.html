<!DOCTYPE html>
<html>
<head>
    <title>QR Code Page</title>
    <style>
        body {
            display: flex;
            flex-direction: column; 
            justify-content: center; 
            align-items: center;     
            margin: 0;
        }
    </style>
</head>
<body>
    <br><br><br>
    <h1>Scan This QR Code to Pay</h1>
    <h2>Amount to be paid: Rs.<span id="amount">â€”</span></h2>

    <!-- QR Code wrapped in link -->
    <a id="qrLink" href="#" target="_blank">
        <img src="qr.png" alt="QR Code">
    </a>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
        // ====== Firebase Config ======
        const firebaseConfig = {
            apiKey: "AIzaSyBWocGhLMcWTHNgS8pW2Y-jV1r5s-2pd6M",
            authDomain: "entry-gate-ddc57.firebaseapp.com",
            databaseURL: "https://entry-gate-ddc57-default-rtdb.firebaseio.com/",
            projectId: "entry-gate-ddc57",
            storageBucket: "entry-gate-ddc57.appspot.com",
        };

        // ====== Initialize Firebase ======
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ====== VEHICLE NUMBER to SEARCH ======
        const vehicleNumber = prompt("Enter your Vehicle Number:"); // e.g. KL24P2604

        // ====== Function to find and display price ======
        function findPrice(snapshot) {
            let found = false;
            const data = snapshot.val();
            for (let slot in data) {
                for (let recordId in data[slot]) {
                    let record = data[slot][recordId];
                    if (record.vehicleNo && record.vehicleNo.toLowerCase() === vehicleNumber.toLowerCase()) {
                        document.getElementById('amount').textContent = record.price;

                        // Update QR link to include both amount & vehicle number
                        const newLink = "https://santhoshbhavanpc.github.io/payment2.1/?amount=" + encodeURIComponent(record.price) + "&vehicleNo=" + encodeURIComponent(vehicleNumber);
                        document.getElementById('qrLink').href = newLink;

                        found = true;
                        break;
                    }
                }
                if (found) break;
            }
            if (!found) {
                document.getElementById('amount').textContent = "Not found";
            }
        }

        // ====== Listen for live updates ======
        db.ref("slots").on("value", findPrice);
    </script>
</body>
</html>
